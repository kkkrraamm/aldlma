<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª - Dalma Admin</title>
    <link rel="stylesheet" href="assets/css/admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1>ğŸŒ´ Ø¯Ù„Ù…Ù€Ù€Ù€Ù€Ø§</h1>
            <p>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
        </div>
        
        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item">
                <span class="icon">ğŸ“Š</span>
                <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </a>
            
            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© -->
            <div class="nav-dropdown">
                <a href="#" class="nav-item" onclick="toggleDropdown(event, 'users-dropdown')">
                    <span class="icon">ğŸ‘¥</span>
                    <span>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                    <span class="dropdown-arrow">â–¼</span>
                </a>
                <div class="dropdown-menu" id="users-dropdown">
                    <a href="users.html" class="dropdown-item">
                        <span class="icon">ğŸ‘¤</span>
                        <span>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                    </a>
                    <a href="create-account.html" class="dropdown-item">
                        <span class="icon">â•</span>
                        <span>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</span>
                    </a>
                </div>
            </div>
            
            <a href="requests.html" class="nav-item active">
                <span class="icon">ğŸ“‹</span>
                <span>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
                <span class="badge" id="allRequestsBadge">0</span>
            </a>
            <a href="provider-requests.html" class="nav-item">
                <span class="icon">ğŸª</span>
                <span>Ø·Ù„Ø¨Ø§Øª Ù…Ù‚Ø¯Ù…ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©</span>
            </a>
            <a href="posts.html" class="nav-item">
                <span class="icon">ğŸ“°</span>
                <span>Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</span>
            </a>
            <a href="orders.html" class="nav-item">
                <span class="icon">ğŸ›’</span>
                <span>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
            </a>
            <a href="#" class="nav-item" onclick="logout()">
                <span class="icon">ğŸšª</span>
                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ <strong id="adminName">Admin</strong></p>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <div>
                <h1>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
                <p>Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ù…Ù‚Ø¯Ù…ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù…ÙŠÙŠÙ†</p>
            </div>
            <div class="header-actions">
                <input type="text" class="search-box" id="searchBox" placeholder="Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...">
                <button class="btn-refresh" onclick="loadAllRequests()">
                    ğŸ”„ ØªØ­Ø¯ÙŠØ«
                </button>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card pending">
                <div class="stat-icon" style="background: #FEF3C7; color: #D97706;">â³</div>
                <div class="stat-content">
                    <h3 id="pendingCount">0</h3>
                    <p>Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</p>
                </div>
            </div>
            <div class="stat-card approved">
                <div class="stat-icon" style="background: #D1FAE5; color: #059669;">âœ…</div>
                <div class="stat-content">
                    <h3 id="approvedCount">0</h3>
                    <p>ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„</p>
                </div>
            </div>
            <div class="stat-card rejected">
                <div class="stat-icon" style="background: #FEE2E2; color: #DC2626;">âŒ</div>
                <div class="stat-content">
                    <h3 id="rejectedCount">0</h3>
                    <p>ØªÙ… Ø§Ù„Ø±ÙØ¶</p>
                </div>
            </div>
            <div class="stat-card highlight">
                <div class="stat-icon" style="background: rgba(45, 106, 79, 0.1); color: #2D6A4F;">ğŸ“Š</div>
                <div class="stat-content">
                    <h3 id="totalCount">0</h3>
                    <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
                </div>
            </div>
        </div>

        <!-- Provider Requests Section -->
        <div class="section">
            <h3>ğŸª Ø·Ù„Ø¨Ø§Øª Ù…Ù‚Ø¯Ù…ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©</h3>
            <div class="filters">
                <div class="filter-group">
                    <button class="filter-btn active" data-filter="all" data-type="provider">Ø§Ù„ÙƒÙ„</button>
                    <button class="filter-btn" data-filter="pending" data-type="provider">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</button>
                    <button class="filter-btn" data-filter="approved" data-type="provider">Ù…Ù‚Ø¨ÙˆÙ„Ø©</button>
                    <button class="filter-btn" data-filter="rejected" data-type="provider">Ù…Ø±ÙÙˆØ¶Ø©</button>
                </div>
            </div>
                <div id="providerRequestsLoading" class="loading">
                    <div class="spinner"></div>
                    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
                </div>
                <div id="providerRequestsContent" style="display: none;">
                    <table class="requests-table">
                        <thead>
                            <tr>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ù†Ø´Ø§Ø·</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="providerRequestsTable">
                        </tbody>
                    </table>
                </div>
                <div id="providerRequestsEmpty" class="empty-state" style="display: none;">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ù‚Ø¯Ù…ÙŠ Ø®Ø¯Ù…Ø©</h3>
                    <p>Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‡Ù†Ø§ Ø¹Ù†Ø¯Ù…Ø§ ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§</p>
                </div>
            </div>

        <!-- Media Requests Section -->
        <div class="section">
            <h3>ğŸ“º Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù…ÙŠÙŠÙ†</h3>
            <div class="filters">
                <div class="filter-group">
                    <button class="filter-btn active" data-filter="all" data-type="media">Ø§Ù„ÙƒÙ„</button>
                    <button class="filter-btn" data-filter="pending" data-type="media">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</button>
                    <button class="filter-btn" data-filter="approved" data-type="media">Ù…Ù‚Ø¨ÙˆÙ„Ø©</button>
                    <button class="filter-btn" data-filter="rejected" data-type="media">Ù…Ø±ÙÙˆØ¶Ø©</button>
                </div>
            </div>
                <div id="mediaRequestsLoading" class="loading">
                    <div class="spinner"></div>
                    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
                </div>
                <div id="mediaRequestsContent" style="display: none;">
                    <table class="requests-table">
                        <thead>
                            <tr>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th>Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</th>
                                <th>Ø§Ù„Ø®Ø¨Ø±Ø©</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="mediaRequestsTable">
                        </tbody>
                    </table>
                </div>
                <div id="mediaRequestsEmpty" class="empty-state" style="display: none;">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                    <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¥Ø¹Ù„Ø§Ù…ÙŠÙŠÙ†</h3>
                    <p>Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‡Ù†Ø§ Ø¹Ù†Ø¯Ù…Ø§ ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Request Details Modal -->
    <div class="modal" id="detailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody"></div>
            <div class="modal-actions" id="modalActions"></div>
        </div>
    </div>

    <!-- Reject Reason Modal -->
    <div class="modal" id="rejectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶</h3>
                <button class="modal-close" onclick="closeRejectModal()">&times;</button>
            </div>
            <p style="color: #666; margin-bottom: 15px;">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨:</p>
            <textarea class="reject-reason" id="rejectReason" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ Ù‡Ù†Ø§..."></textarea>
            <div class="modal-actions">
                <button class="btn btn-reject" onclick="confirmReject()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±ÙØ¶</button>
                <button class="btn btn-delete" onclick="closeRejectModal()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script src="assets/js/admin.js"></script>
    <script>
        // API_URL Ù…Ø¹Ø±Ù‘Ù ÙÙŠ admin.js
        let currentRequestId = null;
        let currentRequestType = null;
        let providerRequests = [];
        let mediaRequests = [];
        let currentProviderFilter = 'all';
        let currentMediaFilter = 'all';

        // Load requests on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadProviderRequests();
            loadMediaRequests();
            setupFilterTabs();
            setupSearch();
        });

        // Load provider requests
        async function loadProviderRequests() {
            try {
                const response = await fetch(`${API_URL}/admin/provider-requests`);
                const data = await response.json();
                providerRequests = data.requests || [];
                renderProviderRequests();
                updateStats();
            } catch (error) {
                console.error('Error loading provider requests:', error);
                showError('providerRequestsLoading', 'ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ù…Ù‚Ø¯Ù…ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©');
            }
        }

        // Load media requests
        async function loadMediaRequests() {
            try {
                const response = await fetch(`${API_URL}/admin/media-requests`);
                const data = await response.json();
                // API returns array directly, not {requests: [...]}
                mediaRequests = Array.isArray(data) ? data : (data.requests || []);
                renderMediaRequests();
                updateStats();
            } catch (error) {
                console.error('Error loading media requests:', error);
                showError('mediaRequestsLoading', 'ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù…ÙŠÙŠÙ†');
            }
        }

        // Render provider requests
        function renderProviderRequests() {
            const loading = document.getElementById('providerRequestsLoading');
            const content = document.getElementById('providerRequestsContent');
            const empty = document.getElementById('providerRequestsEmpty');
            const tbody = document.getElementById('providerRequestsTable');

            loading.style.display = 'none';

            const filteredRequests = currentProviderFilter === 'all' 
                ? providerRequests 
                : providerRequests.filter(r => r.status === currentProviderFilter);

            if (filteredRequests.length === 0) {
                content.style.display = 'none';
                empty.style.display = 'block';
                return;
            }

            content.style.display = 'block';
            empty.style.display = 'none';

            tbody.innerHTML = filteredRequests.map(request => `
                <tr>
                    <td>#${request.id}</td>
                    <td><strong>${request.business_name}</strong></td>
                    <td>${request.business_category}</td>
                    <td>${request.whatsapp_number}</td>
                    <td>${request.location_address}</td>
                    <td><span class="status-badge ${request.status}">${getStatusText(request.status)}</span></td>
                    <td>${formatDate(request.created_at)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-view" onclick="viewProviderRequest(${request.id})">Ø¹Ø±Ø¶</button>
                            ${request.status === 'pending' ? `
                                <button class="btn btn-approve" onclick="approveProviderRequest(${request.id})">Ù‚Ø¨ÙˆÙ„</button>
                                <button class="btn btn-reject" onclick="startRejectRequest(${request.id}, 'provider')">Ø±ÙØ¶</button>
                            ` : ''}
                            <button class="btn btn-delete" onclick="deleteProviderRequest(${request.id})">Ø­Ø°Ù</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Render media requests
        function renderMediaRequests() {
            const loading = document.getElementById('mediaRequestsLoading');
            const content = document.getElementById('mediaRequestsContent');
            const empty = document.getElementById('mediaRequestsEmpty');
            const tbody = document.getElementById('mediaRequestsTable');

            loading.style.display = 'none';

            const filteredRequests = currentMediaFilter === 'all' 
                ? mediaRequests 
                : mediaRequests.filter(r => r.status === currentMediaFilter);

            if (filteredRequests.length === 0) {
                content.style.display = 'none';
                empty.style.display = 'block';
                return;
            }

            content.style.display = 'block';
            empty.style.display = 'none';

            tbody.innerHTML = filteredRequests.map(request => `
                <tr>
                    <td>#${request.id}</td>
                    <td><strong>${request.name || request.user_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</strong></td>
                    <td>${request.phone || request.user_phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                    <td>${request.portfolio_url ? `<a href="${request.portfolio_url}" target="_blank" style="color: #2D6A4F; text-decoration: none;">Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</a>` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                    <td>${request.experience ? request.experience.substring(0, 30) + '...' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                    <td><span class="status-badge ${request.status}">${getStatusText(request.status)}</span></td>
                    <td>${formatDate(request.created_at)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-view" onclick="viewMediaRequest(${request.id})">Ø¹Ø±Ø¶</button>
                            ${request.status === 'pending' ? `
                                <button class="btn btn-approve" onclick="approveMediaRequest(${request.id})">Ù‚Ø¨ÙˆÙ„</button>
                                <button class="btn btn-reject" onclick="startRejectRequest(${request.id}, 'media')">Ø±ÙØ¶</button>
                            ` : ''}
                            <button class="btn btn-delete" onclick="deleteMediaRequest(${request.id})">Ø­Ø°Ù</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // View provider request details
        function viewProviderRequest(id) {
            const request = providerRequests.find(r => r.id === id);
            if (!request) return;

            document.getElementById('modalTitle').textContent = `ØªÙØ§ØµÙŠÙ„ Ø·Ù„Ø¨ Ù…Ù‚Ø¯Ù… Ø®Ø¯Ù…Ø© #${id}`;
            document.getElementById('modalBody').innerHTML = `
                <h4 style="color: #2D6A4F; margin-bottom: 15px; border-bottom: 2px solid #2D6A4F; padding-bottom: 10px;">ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h4>
                <div class="detail-row">
                    <div class="detail-label">Ø§Ù„Ø§Ø³Ù…:</div>
                    <div class="detail-value"><strong>${request.user_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</strong></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„:</div>
                    <div class="detail-value">${request.user_phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ:</div>
                    <div class="detail-value"><span class="status-badge pending">${request.current_role === 'user' ? 'Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ' : request.current_role === 'media' ? 'Ø¥Ø¹Ù„Ø§Ù…ÙŠ' : 'Ù…Ù‚Ø¯Ù… Ø®Ø¯Ù…Ø©'}</span></div>
                </div>
                
                <h4 style="color: #2D6A4F; margin: 20px 0 15px; border-bottom: 2px solid #2D6A4F; padding-bottom: 10px;">ğŸª Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</h4>
                <div class="detail-row">
                    <div class="detail-label">Ø§Ø³Ù… Ø§Ù„Ù†Ø´Ø§Ø·:</div>
                    <div class="detail-value"><strong>${request.business_name}</strong></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·:</div>
                    <div class="detail-value">${request.business_category}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:</div>
                    <div class="detail-value">${request.whatsapp_number}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</div>
                    <div class="detail-value">${request.email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</div>
                    <div class="detail-value">${request.location_address}</div>
                </div>
                
                <h4 style="color: #2D6A4F; margin: 20px 0 15px; border-bottom: 2px solid #2D6A4F; padding-bottom: 10px;">ğŸ“‹ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h4>
                <div class="detail-row">
                    <div class="detail-label">Ø§Ù„Ø­Ø§Ù„Ø©:</div>
                    <div class="detail-value"><span class="status-badge ${request.status}">${getStatusText(request.status)}</span></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨:</div>
                    <div class="detail-value">${formatDate(request.created_at)}</div>
                </div>
                ${request.rejected_reason ? `
                    <div class="detail-row">
                        <div class="detail-label">Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶:</div>
                        <div class="detail-value" style="color: #DC2626;">${request.rejected_reason}</div>
                    </div>
                ` : ''}
            `;

            document.getElementById('modalActions').innerHTML = request.status === 'pending' ? `
                <button class="btn btn-approve" onclick="approveProviderRequest(${id}); closeModal();">Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨</button>
                <button class="btn btn-reject" onclick="startRejectRequest(${id}, 'provider'); closeModal();">Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨</button>
                <button class="btn btn-delete" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
            ` : `
                <button class="btn btn-delete" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
            `;

            document.getElementById('detailsModal').classList.add('active');
        }

        // View media request details
        function viewMediaRequest(id) {
            const request = mediaRequests.find(r => r.id === id);
            if (!request) return;

            document.getElementById('modalTitle').textContent = `ØªÙØ§ØµÙŠÙ„ Ø·Ù„Ø¨ Ø¥Ø¹Ù„Ø§Ù…ÙŠ #${id}`;
            document.getElementById('modalBody').innerHTML = `
                <h4 style="color: #2D6A4F; margin-bottom: 15px; border-bottom: 2px solid #2D6A4F; padding-bottom: 10px;">ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h4>
                <div class="detail-row">
                    <div class="detail-label">Ø§Ù„Ø§Ø³Ù…:</div>
                    <div class="detail-value"><strong>${request.name || request.user_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</strong></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„:</div>
                    <div class="detail-value">${request.phone || request.user_phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ:</div>
                    <div class="detail-value"><span class="status-badge pending">${request.current_role === 'user' ? 'Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ' : request.current_role === 'media' ? 'Ø¥Ø¹Ù„Ø§Ù…ÙŠ' : 'Ù…Ù‚Ø¯Ù… Ø®Ø¯Ù…Ø©'}</span></div>
                </div>
                
                <h4 style="color: #2D6A4F; margin: 20px 0 15px; border-bottom: 2px solid #2D6A4F; padding-bottom: 10px;">ğŸ“º Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h4>
                <div class="detail-row">
                    <div class="detail-label">Ø§Ù„Ø³Ø¨Ø¨:</div>
                    <div class="detail-value">${request.reason || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø¹Ù…Ø§Ù„:</div>
                    <div class="detail-value">${request.portfolio_url ? `<a href="${request.portfolio_url}" target="_blank" style="color: #2D6A4F;">${request.portfolio_url}</a>` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Ø§Ù„Ø®Ø¨Ø±Ø©:</div>
                    <div class="detail-value">${request.experience || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                </div>
                
                <h4 style="color: #2D6A4F; margin: 20px 0 15px; border-bottom: 2px solid #2D6A4F; padding-bottom: 10px;">ğŸ“‹ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h4>
                <div class="detail-row">
                    <div class="detail-label">Ø§Ù„Ø­Ø§Ù„Ø©:</div>
                    <div class="detail-value"><span class="status-badge ${request.status}">${getStatusText(request.status)}</span></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨:</div>
                    <div class="detail-value">${formatDate(request.created_at)}</div>
                </div>
                ${request.admin_notes ? `
                    <div class="detail-row">
                        <div class="detail-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</div>
                        <div class="detail-value" style="color: #DC2626;">${request.admin_notes}</div>
                    </div>
                ` : ''}
            `;

            document.getElementById('modalActions').innerHTML = request.status === 'pending' ? `
                <button class="btn btn-approve" onclick="approveMediaRequest(${id}); closeModal();">Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨</button>
                <button class="btn btn-reject" onclick="startRejectRequest(${id}, 'media'); closeModal();">Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨</button>
                <button class="btn btn-delete" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
            ` : `
                <button class="btn btn-delete" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
            `;

            document.getElementById('detailsModal').classList.add('active');
        }

        // Approve provider request
        async function approveProviderRequest(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù‚Ø¨ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;

            try {
                const response = await fetch(`${API_URL}/admin/provider-requests/${id}/approve`, {
                    method: 'POST'
                });

                if (response.ok) {
                    alert('ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
                    loadProviderRequests();
                } else {
                    alert('ÙØ´Ù„ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨');
                }
            } catch (error) {
                console.error('Error approving request:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨');
            }
        }

        // Approve media request
        async function approveMediaRequest(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù‚Ø¨ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;

            try {
                const response = await fetch(`${API_URL}/admin/media-requests/${id}/approve`, {
                    method: 'POST'
                });

                if (response.ok) {
                    alert('ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
                    loadMediaRequests();
                } else {
                    alert('ÙØ´Ù„ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨');
                }
            } catch (error) {
                console.error('Error approving request:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨');
            }
        }

        // Start reject request
        function startRejectRequest(id, type) {
            currentRequestId = id;
            currentRequestType = type;
            document.getElementById('rejectReason').value = '';
            document.getElementById('rejectModal').classList.add('active');
        }

        // Confirm reject
        async function confirmReject() {
            const reason = document.getElementById('rejectReason').value.trim();
            
            if (!reason) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶');
                return;
            }

            try {
                const endpoint = currentRequestType === 'provider' 
                    ? `/admin/provider-requests/${currentRequestId}/reject`
                    : `/admin/media-requests/${currentRequestId}/reject`;

                const response = await fetch(`${API_URL}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ reason })
                });

                if (response.ok) {
                    alert('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨');
                    closeRejectModal();
                    
                    if (currentRequestType === 'provider') {
                        loadProviderRequests();
                    } else {
                        loadMediaRequests();
                    }
                } else {
                    alert('ÙØ´Ù„ Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨');
                }
            } catch (error) {
                console.error('Error rejecting request:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨');
            }
        }

        // Delete provider request
        async function deleteProviderRequest(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;

            try {
                const response = await fetch(`${API_URL}/admin/provider-requests/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                    loadProviderRequests();
                } else {
                    alert('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨');
                }
            } catch (error) {
                console.error('Error deleting request:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨');
            }
        }

        // Delete media request
        async function deleteMediaRequest(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;

            try {
                const response = await fetch(`${API_URL}/admin/media-requests/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                    loadMediaRequests();
                } else {
                    alert('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨');
                }
            } catch (error) {
                console.error('Error deleting request:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨');
            }
        }

        // Update statistics
        function updateStats() {
            const allRequests = [...providerRequests, ...mediaRequests];
            
            document.getElementById('totalCount').textContent = allRequests.length;
            document.getElementById('pendingCount').textContent = allRequests.filter(r => r.status === 'pending').length;
            document.getElementById('approvedCount').textContent = allRequests.filter(r => r.status === 'approved').length;
            document.getElementById('rejectedCount').textContent = allRequests.filter(r => r.status === 'rejected').length;
        }

        // Setup filter tabs
        function setupFilterTabs() {
            document.querySelectorAll('.filter-btn').forEach(tab => {
                tab.addEventListener('click', () => {
                    const filter = tab.dataset.filter;
                    const type = tab.dataset.type;
                    
                    // Update active tab
                    tab.parentElement.querySelectorAll('.filter-btn').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Update filter and re-render
                    if (type === 'provider') {
                        currentProviderFilter = filter;
                        renderProviderRequests();
                    } else {
                        currentMediaFilter = filter;
                        renderMediaRequests();
                    }
                });
            });
        }

        // Setup search
        function setupSearch() {
            const searchBox = document.getElementById('searchBox');
            searchBox.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                
                // Filter provider requests
                const filteredProvider = providerRequests.filter(r => 
                    r.business_name.toLowerCase().includes(query) ||
                    r.business_category.toLowerCase().includes(query) ||
                    r.whatsapp_number.includes(query) ||
                    r.location_address.toLowerCase().includes(query)
                );
                
                // Filter media requests
                const filteredMedia = mediaRequests.filter(r => 
                    (r.user_name || '').toLowerCase().includes(query) ||
                    (r.user_phone || '').includes(query) ||
                    (r.email || '').toLowerCase().includes(query) ||
                    (r.content_type || '').toLowerCase().includes(query)
                );
                
                // Temporarily override the arrays
                const originalProvider = providerRequests;
                const originalMedia = mediaRequests;
                
                providerRequests = filteredProvider;
                mediaRequests = filteredMedia;
                
                renderProviderRequests();
                renderMediaRequests();
                
                // Restore original arrays
                if (query === '') {
                    providerRequests = originalProvider;
                    mediaRequests = originalMedia;
                }
            });
        }

        // Utility functions
        function getStatusText(status) {
            const statusMap = {
                'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                'approved': 'Ù…Ù‚Ø¨ÙˆÙ„',
                'rejected': 'Ù…Ø±ÙÙˆØ¶'
            };
            return statusMap[status] || status;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-SA', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function closeModal() {
            document.getElementById('detailsModal').classList.remove('active');
        }

        function closeRejectModal() {
            document.getElementById('rejectModal').classList.remove('active');
            currentRequestId = null;
            currentRequestType = null;
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <div style="color: #DC2626; padding: 40px; text-align: center;">
                    <p style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£</p>
                    <p>${message}</p>
                    <button class="btn btn-view" onclick="location.reload()" style="margin-top: 20px;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
                </div>
            `;
        }

        // Auto refresh every 30 seconds
        setInterval(() => {
            loadProviderRequests();
            loadMediaRequests();
        }, 30000);

        // Toggle dropdown menu
        function toggleDropdown(event, dropdownId) {
            event.preventDefault();
            const dropdown = document.getElementById(dropdownId);
            const isActive = dropdown.classList.contains('show');
            
            // Close all dropdowns first
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                menu.classList.remove('show');
            });
            
            // Toggle current dropdown
            if (!isActive) {
                dropdown.classList.add('show');
            }
        }

        // Logout function
        function logout() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                window.location.href = 'login.html';
            }
        }
    </script>
</body>
</html>


