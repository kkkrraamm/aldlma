<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชูุงุตูู ุงููุณุชุฎุฏู - ุฏููุง</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/admin.css">
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>๐ด ุฏููููููุง</h1>
                <p>ููุญุฉ ุงูุชุญูู</p>
            </div>
            
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-item">
                    <span class="icon">๐</span>
                    <span>ุงูุฑุฆูุณูุฉ</span>
                </a>
                <a href="users.html" class="nav-item active">
                    <span class="icon">๐ฅ</span>
                    <span>ุงููุณุชุฎุฏููู</span>
                </a>
                <a href="media-requests.html" class="nav-item">
                    <span class="icon">๐</span>
                    <span>ุทูุจุงุช ุงูุฅุนูุงูููู</span>
                </a>
                <a href="posts.html" class="nav-item">
                    <span class="icon">๐ฐ</span>
                    <span>ุงูููุดูุฑุงุช</span>
                </a>
                <a href="orders.html" class="nav-item">
                    <span class="icon">๐</span>
                    <span>ุงูุทูุจุงุช</span>
                </a>
                <a href="#" class="nav-item" onclick="logout()">
                    <span class="icon">๐ช</span>
                    <span>ุชุณุฌูู ุงูุฎุฑูุฌ</span>
                </a>
            </nav>
            
            <div class="sidebar-footer">
                <p>ูุฑุญุจุงูุ <strong id="adminName">Admin</strong></p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button onclick="window.history.back()" style="background: none; border: none; cursor: pointer; font-size: 24px;">โ</button>
                    <h2>ุชูุงุตูู ุงููุณุชุฎุฏู</h2>
                </div>
                <div class="header-actions">
                    <button class="btn-refresh" onclick="loadUserDetails()">๐ ุชุญุฏูุซ</button>
                </div>
            </header>

            <!-- Loading -->
            <div id="loadingState" style="text-align: center; padding: 100px 20px;">
                <div style="font-size: 48px; margin-bottom: 20px;">โณ</div>
                <p style="color: #6B7280;">ุฌุงุฑู ุงูุชุญููู...</p>
            </div>

            <!-- User Details -->
            <div id="userDetails" style="display: none;">
                <!-- Basic Info Card -->
                <section class="section">
                    <h3 style="margin-bottom: 20px;">ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: #F9FAFB; padding: 15px; border-radius: 10px;">
                            <p style="color: #6B7280; font-size: 13px; margin-bottom: 5px;">ุงูุงุณู</p>
                            <p style="font-weight: 600; font-size: 16px;" id="userName">-</p>
                        </div>
                        <div style="background: #F9FAFB; padding: 15px; border-radius: 10px;">
                            <p style="color: #6B7280; font-size: 13px; margin-bottom: 5px;">ุฑูู ุงููุงุชู</p>
                            <p style="font-weight: 600; font-size: 16px;" id="userPhone">-</p>
                        </div>
                        <div style="background: #F9FAFB; padding: 15px; border-radius: 10px;">
                            <p style="color: #6B7280; font-size: 13px; margin-bottom: 5px;">ุงูุฏูุฑ</p>
                            <p style="font-weight: 600; font-size: 16px;" id="userRole">-</p>
                        </div>
                        <div style="background: #F9FAFB; padding: 15px; border-radius: 10px;">
                            <p style="color: #6B7280; font-size: 13px; margin-bottom: 5px;">ุชุงุฑูุฎ ุงูุชุณุฌูู</p>
                            <p style="font-weight: 600; font-size: 16px;" id="userCreatedAt">-</p>
                        </div>
                    </div>
                </section>

                <!-- Status Card -->
                <section class="section">
                    <h3 style="margin-bottom: 20px;">ุงูุญุงูุฉ</h3>
                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-weight: 600;">ูุนุชูุฏ:</span>
                            <span id="userVerified">-</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-weight: 600;">ูุดุท:</span>
                            <span id="userActive">-</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-weight: 600;">ูุญุธูุฑ:</span>
                            <span id="userBlocked">-</span>
                        </div>
                    </div>
                    
                    <div id="blockReasonSection" style="display: none; margin-top: 20px; padding: 15px; background: #FEE2E2; border-radius: 10px;">
                        <p style="font-weight: 600; margin-bottom: 5px; color: #DC2626;">ุณุจุจ ุงูุญุธุฑ:</p>
                        <p id="blockReason" style="color: #991B1B;"></p>
                        <p style="font-size: 13px; color: #6B7280; margin-top: 10px;">ุชุงุฑูุฎ ุงูุญุธุฑ: <span id="blockDate">-</span></p>
                    </div>
                </section>

                <!-- Bio (if exists) -->
                <section class="section" id="bioSection" style="display: none;">
                    <h3 style="margin-bottom: 15px;">ุงููุจุฐุฉ ุงูุชุนุฑูููุฉ</h3>
                    <p id="userBio" style="color: #374151; line-height: 1.6;"></p>
                </section>

                <!-- Media Stats (for media users) -->
                <section class="section" id="mediaStats" style="display: none;">
                    <h3 style="margin-bottom: 20px;">ุฅุญุตุงุฆูุงุช ุงูุฅุนูุงูู</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #DBEAFE;">๐</div>
                            <div class="stat-content">
                                <h3 id="mediaPosts">0</h3>
                                <p>ุงูููุดูุฑุงุช</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #D1FAE5;">๐ฅ</div>
                            <div class="stat-content">
                                <h3 id="mediaFollowers">0</h3>
                                <p>ุงููุชุงุจุนูู</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #FCE7F3;">โค๏ธ</div>
                            <div class="stat-content">
                                <h3 id="mediaLikes">0</h3>
                                <p>ุงูุฅุนุฌุงุจุงุช</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #FEF3C7;">๐๏ธ</div>
                            <div class="stat-content">
                                <h3 id="mediaViews">0</h3>
                                <p>ุงููุดุงูุฏุงุช</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Media Posts (for media users) -->
                <section class="section" id="mediaPostsSection" style="display: none;">
                    <h3 style="margin-bottom: 20px;">ููุดูุฑุงุช ุงูุฅุนูุงูู</h3>
                    <div id="mediaPostsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;"></div>
                </section>

                <!-- Provider Profile (for providers) -->
                <section class="section" id="providerSection" style="display: none;">
                    <h3 style="margin-bottom: 20px;">ุจุฑููุงูู ููุฏู ุงูุฎุฏูุฉ</h3>
                    <div id="providerContent"></div>
                </section>

                <!-- Media Request (if exists) -->
                <section class="section" id="mediaRequestSection" style="display: none;">
                    <h3 style="margin-bottom: 15px;">ุทูุจ ุงูุชุญููู ุฅูู ุฅุนูุงูู</h3>
                    <div id="mediaRequestContent"></div>
                </section>

                <!-- Actions -->
                <section class="section">
                    <h3 style="margin-bottom: 20px;">ุงูุฅุฌุฑุงุกุงุช</h3>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button onclick="showEditModal()" class="btn btn-primary">โ๏ธ ุชุนุฏูู ุงููุนูููุงุช</button>
                        <button onclick="showBlockModal()" class="btn" id="blockBtn" style="background: #F59E0B;">๐ซ ุญุธุฑ</button>
                        <button onclick="deleteUser()" class="btn btn-danger">๐๏ธ ุญุฐู ุงูุญุณุงุจ</button>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Block Modal -->
    <div id="blockModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 500px;">
            <h3 style="margin-bottom: 20px;" id="blockModalTitle">ุญุธุฑ ุงููุณุชุฎุฏู</h3>
            <form id="blockForm">
                <input type="hidden" id="blockAction">
                
                <div id="reasonSection" style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 600;">ุณุจุจ ุงูุญุธุฑ</label>
                    <textarea id="blockReasonInput" rows="4" style="width: 100%; padding: 10px; border: 2px solid #E5E7EB; border-radius: 8px; font-family: Cairo; resize: vertical;"></textarea>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" onclick="closeBlockModal()" style="padding: 10px 20px; border: 2px solid #E5E7EB; background: white; border-radius: 8px; cursor: pointer; font-family: Cairo; font-weight: 600;">ุฅูุบุงุก</button>
                    <button type="submit" class="btn" id="blockSubmitBtn">ุชุฃููุฏ</button>
                </div>
            </form>
        </div>
    </div>

    <script src="assets/js/admin.js"></script>
    <script>
        const userId = new URLSearchParams(window.location.search).get('id');
        let currentUser = null;

        async function loadUserDetails() {
            if (!userId) {
                window.location.href = 'users.html';
                return;
            }

            try {
                const response = await apiRequest(`/admin/users/${userId}`);
                const data = await response.json();
                
                currentUser = data.user;
                renderUserDetails(data);
                
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('userDetails').style.display = 'block';
            } catch (error) {
                showToast('ุฎุทุฃ ูู ุชุญููู ุงูุจูุงูุงุช', 'error');
            }
        }

        function renderUserDetails(data) {
            const user = data.user;
            
            // Basic Info
            document.getElementById('userName').textContent = user.name;
            document.getElementById('userPhone').textContent = formatPhone(user.phone);
            document.getElementById('userRole').textContent = 
                user.role === 'media' ? 'ุฅุนูุงูู' : 
                user.role === 'provider' ? 'ููุฏู ุฎุฏูุฉ' : 'ูุณุชุฎุฏู';
            document.getElementById('userCreatedAt').textContent = formatDate(user.created_at);
            
            // Status
            document.getElementById('userVerified').innerHTML = user.is_verified ? 
                '<span style="color: #10B981;">โ ูุนุชูุฏ</span>' : 
                '<span style="color: #6B7280;">โ ุบูุฑ ูุนุชูุฏ</span>';
            document.getElementById('userActive').innerHTML = user.is_active ? 
                '<span style="color: #10B981;">โ ูุดุท</span>' : 
                '<span style="color: #DC2626;">โ ุบูุฑ ูุดุท</span>';
            document.getElementById('userBlocked').innerHTML = user.is_blocked ? 
                '<span style="color: #DC2626;">๐ซ ูุญุธูุฑ</span>' : 
                '<span style="color: #10B981;">โ ุบูุฑ ูุญุธูุฑ</span>';
            
            // Block Reason
            if (user.is_blocked && user.blocked_reason) {
                document.getElementById('blockReasonSection').style.display = 'block';
                document.getElementById('blockReason').textContent = user.blocked_reason;
                document.getElementById('blockDate').textContent = formatDate(user.blocked_at);
            }
            
            // Bio
            if (user.bio) {
                document.getElementById('bioSection').style.display = 'block';
                document.getElementById('userBio').textContent = user.bio;
            }
            
            // Media Stats & Posts
            if (user.role === 'media' && data.stats) {
                document.getElementById('mediaStats').style.display = 'block';
                document.getElementById('mediaPosts').textContent = data.stats.posts?.total_posts || 0;
                document.getElementById('mediaFollowers').textContent = data.stats.followers || 0;
                document.getElementById('mediaLikes').textContent = data.stats.posts?.total_likes || 0;
                document.getElementById('mediaViews').textContent = data.stats.posts?.total_views || 0;
                
                // Load media posts
                loadMediaPosts();
            }
            
            // Provider Profile
            if (user.role === 'provider') {
                loadProviderProfile();
            }
            
            // Media Request
            if (data.mediaRequest) {
                document.getElementById('mediaRequestSection').style.display = 'block';
                const req = data.mediaRequest;
                document.getElementById('mediaRequestContent').innerHTML = `
                    <div style="background: ${req.status === 'pending' ? '#FEF3C7' : req.status === 'approved' ? '#D1FAE5' : '#FEE2E2'}; padding: 15px; border-radius: 10px;">
                        <p style="font-weight: 600; margin-bottom: 10px;">
                            ุงูุญุงูุฉ: ${req.status === 'pending' ? 'โณ ููุฏ ุงููุฑุงุฌุนุฉ' : req.status === 'approved' ? 'โ ููุจูู' : 'โ ูุฑููุถ'}
                        </p>
                        <p style="margin-bottom: 10px;"><strong>ุงูุณุจุจ:</strong> ${req.reason}</p>
                        ${req.admin_notes ? `<p><strong>ููุงุญุธุงุช ุงููุดุฑู:</strong> ${req.admin_notes}</p>` : ''}
                    </div>
                `;
            }
            
            // Update block button
            const blockBtn = document.getElementById('blockBtn');
            if (user.is_blocked) {
                blockBtn.textContent = 'โ ุฅูุบุงุก ุงูุญุธุฑ';
                blockBtn.style.background = '#10B981';
            } else {
                blockBtn.textContent = '๐ซ ุญุธุฑ';
                blockBtn.style.background = '#F59E0B';
            }
        }

        async function loadMediaPosts() {
            try {
                const response = await apiRequest(`/admin/users/${userId}/posts`);
                const posts = await response.json();
                
                if (posts && posts.length > 0) {
                    document.getElementById('mediaPostsSection').style.display = 'block';
                    renderMediaPosts(posts);
                }
            } catch (error) {
                console.error('Error loading media posts:', error);
            }
        }

        function renderMediaPosts(posts) {
            const grid = document.getElementById('mediaPostsGrid');
            
            grid.innerHTML = posts.map(post => `
                <div style="background: white; border: 2px solid #E5E7EB; border-radius: 12px; padding: 20px; display: flex; flex-direction: column;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                        <div>
                            <h4 style="font-size: 16px; font-weight: 700; margin-bottom: 5px;">${post.title || 'ุจุฏูู ุนููุงู'}</h4>
                            <p style="color: #6B7280; font-size: 13px;">${formatDate(post.created_at)}</p>
                        </div>
                        <span class="badge ${post.is_approved ? 'badge-success' : 'badge-warning'}">
                            ${post.is_approved ? 'โ ูุนุชูุฏ' : 'โณ ููุฏ ุงููุฑุงุฌุนุฉ'}
                        </span>
                    </div>
                    
                    ${post.content ? `
                        <p style="color: #374151; line-height: 1.6; margin-bottom: 15px; max-height: 100px; overflow: hidden;">${post.content}</p>
                    ` : ''}
                    
                    ${post.media_url && post.media_type === 'image' ? `
                        <img src="${post.media_url}" style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px; margin-bottom: 15px;" onerror="this.style.display='none'">
                    ` : ''}
                    
                    ${post.media_url && post.media_type === 'video' ? `
                        <div style="width: 100%; height: 200px; background: #F3F4F6; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 15px;">
                            <span style="font-size: 48px;">๐ฅ</span>
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 20px; margin-top: auto; padding-top: 15px; border-top: 1px solid #E5E7EB;">
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <span>โค๏ธ</span>
                            <span style="font-weight: 600; color: #059669;">${post.likes_count || 0}</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <span>๐๏ธ</span>
                            <span style="font-weight: 600; color: #059669;">${post.views_count || 0}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function loadProviderProfile() {
            document.getElementById('providerSection').style.display = 'block';
            
            try {
                const response = await apiRequest(`/admin/users/${userId}/services`);
                const services = await response.json();
                
                if (services && services.length > 0) {
                    renderProviderServices(services);
                } else {
                    document.getElementById('providerContent').innerHTML = `
                        <div style="text-align: center; padding: 40px; background: #F9FAFB; border-radius: 12px;">
                            <div style="font-size: 48px; margin-bottom: 15px;">๐ช</div>
                            <p style="color: #6B7280; font-size: 16px;">ูุง ุชูุฌุฏ ุฎุฏูุงุช ูุถุงูุฉ ุจุนุฏ</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading provider services:', error);
                document.getElementById('providerContent').innerHTML = `
                    <div style="text-align: center; padding: 40px; background: #FEE2E2; border-radius: 12px;">
                        <p style="color: #DC2626;">ุฎุทุฃ ูู ุชุญููู ุงูุฎุฏูุงุช</p>
                    </div>
                `;
            }
        }

        function renderProviderServices(services) {
            // ุญุณุงุจ ุฅุฌูุงูู ุงูุฅุญุตุงุฆูุงุช
            const totalOrders = services.reduce((sum, s) => sum + (s.orders_count || 0), 0);
            const avgRating = services.length > 0 
                ? (services.reduce((sum, s) => sum + (parseFloat(s.rating) || 0), 0) / services.length).toFixed(1)
                : 0;
            const totalReviews = services.reduce((sum, s) => sum + (s.reviews_count || 0), 0);
            
            document.getElementById('providerContent').innerHTML = `
                <!-- ุฅุญุตุงุฆูุงุช -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #DBEAFE;">๐ช</div>
                        <div class="stat-content">
                            <h3>${services.length}</h3>
                            <p>ุงูุฎุฏูุงุช</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #FEF3C7;">โญ</div>
                        <div class="stat-content">
                            <h3>${avgRating}</h3>
                            <p>ูุชูุณุท ุงูุชูููู</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #D1FAE5;">๐</div>
                        <div class="stat-content">
                            <h3>${totalOrders}</h3>
                            <p>ุงูุทูุจุงุช</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #FCE7F3;">๐ฌ</div>
                        <div class="stat-content">
                            <h3>${totalReviews}</h3>
                            <p>ุงูุชููููุงุช</p>
                        </div>
                    </div>
                </div>
                
                <!-- ูุงุฆูุฉ ุงูุฎุฏูุงุช -->
                <h4 style="margin-bottom: 15px; font-weight: 700;">ุงูุฎุฏูุงุช ุงููุชููุฑุฉ:</h4>
                <div style="display: grid; gap: 15px;">
                    ${services.map(service => `
                        <div style="background: white; border: 2px solid #E5E7EB; border-radius: 12px; padding: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                <div style="flex: 1;">
                                    <h5 style="font-size: 18px; font-weight: 700; margin-bottom: 5px;">${service.service_name}</h5>
                                    ${service.category ? `<span class="badge" style="background: #E0E7FF; color: #3730A3;">${service.category}</span>` : ''}
                                </div>
                                <div style="text-align: left;">
                                    <p style="font-size: 24px; font-weight: 700; color: #059669; margin-bottom: 5px;">${service.price || 0} ุฑ.ุณ</p>
                                    <span class="badge ${service.is_active ? 'badge-success' : 'badge-warning'}">
                                        ${service.is_active ? 'โ ูุดุท' : 'โธ๏ธ ุบูุฑ ูุดุท'}
                                    </span>
                                </div>
                            </div>
                            
                            ${service.description ? `
                                <p style="color: #374151; line-height: 1.6; margin-bottom: 15px;">${service.description}</p>
                            ` : ''}
                            
                            <div style="display: flex; gap: 20px; padding-top: 15px; border-top: 1px solid #E5E7EB;">
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <span>๐</span>
                                    <span style="font-weight: 600; color: #059669;">${service.orders_count || 0} ุทูุจ</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <span>โญ</span>
                                    <span style="font-weight: 600; color: #F59E0B;">${service.rating || 0}</span>
                                    <span style="color: #6B7280; font-size: 13px;">(${service.reviews_count || 0} ุชูููู)</span>
                                </div>
                                <div style="margin-right: auto; color: #6B7280; font-size: 13px;">
                                    ${formatDate(service.created_at)}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function showBlockModal() {
            if (!currentUser) return;
            
            const isBlocked = currentUser.is_blocked;
            document.getElementById('blockAction').value = isBlocked ? 'unblock' : 'block';
            document.getElementById('blockModalTitle').textContent = isBlocked ? 'ุฅูุบุงุก ุญุธุฑ ุงููุณุชุฎุฏู' : 'ุญุธุฑ ุงููุณุชุฎุฏู';
            document.getElementById('reasonSection').style.display = isBlocked ? 'none' : 'block';
            document.getElementById('blockSubmitBtn').textContent = isBlocked ? 'ุฅูุบุงุก ุงูุญุธุฑ' : 'ุญุธุฑ';
            document.getElementById('blockSubmitBtn').className = isBlocked ? 'btn btn-success' : 'btn btn-danger';
            document.getElementById('blockReasonInput').value = '';
            
            document.getElementById('blockModal').style.display = 'flex';
        }

        function closeBlockModal() {
            document.getElementById('blockModal').style.display = 'none';
        }

        document.getElementById('blockForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const action = document.getElementById('blockAction').value;
            const reason = document.getElementById('blockReasonInput').value;
            
            if (action === 'block' && !reason.trim()) {
                showToast('ูุฑุฌู ูุชุงุจุฉ ุณุจุจ ุงูุญุธุฑ', 'error');
                return;
            }
            
            try {
                const response = await apiRequest(`/admin/users/${userId}/block`, {
                    method: 'POST',
                    body: JSON.stringify({
                        is_blocked: action === 'block',
                        blocked_reason: action === 'block' ? reason : null
                    })
                });
                
                if (response.ok) {
                    showToast(action === 'block' ? 'ุชู ุญุธุฑ ุงููุณุชุฎุฏู ุจูุฌุงุญ' : 'ุชู ุฅูุบุงุก ุงูุญุธุฑ ุจูุฌุงุญ');
                    closeBlockModal();
                    loadUserDetails();
                } else {
                    showToast('ุญุฏุซ ุฎุทุฃ', 'error');
                }
            } catch (error) {
                showToast('ุญุฏุซ ุฎุทุฃ', 'error');
            }
        });

        async function deleteUser() {
            if (!confirmDialog(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ${currentUser.name}ุ\n\nูุฐุง ุงูุฅุฌุฑุงุก ูุง ูููู ุงูุชุฑุงุฌุน ุนูู!`)) return;
            
            try {
                const response = await apiRequest(`/admin/users/${userId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showToast('ุชู ุญุฐู ุงููุณุชุฎุฏู ุจูุฌุงุญ');
                    setTimeout(() => window.location.href = 'users.html', 1500);
                } else {
                    showToast('ุญุฏุซ ุฎุทุฃ', 'error');
                }
            } catch (error) {
                showToast('ุญุฏุซ ุฎุทุฃ', 'error');
            }
        }

        function showEditModal() {
            showToast('ุณูุชู ุฅุถุงูุฉ ูุฐู ุงูููุฒุฉ ูุฑูุจุงู');
        }

        // Load on page load
        loadUserDetails();
    </script>
</body>
</html>

