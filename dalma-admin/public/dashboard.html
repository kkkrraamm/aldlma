<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¯Ù„Ù…Ø§ - AALDMA Control Panel</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        body { font-family: 'Cairo', sans-serif; }
        .sidebar { transition: all 0.3s ease; }
        .main-content { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-card { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .stat-card-2 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-card-3 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .stat-card-4 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar fixed inset-y-0 right-0 w-64 bg-white shadow-lg transform translate-x-0 z-30">
        <div class="flex items-center justify-center h-16 bg-gradient-to-r from-blue-600 to-purple-600">
            <h1 class="text-white text-xl font-bold">ğŸ›ï¸ Ø§Ù„Ø¯Ù„Ù…Ø§</h1>
        </div>
        
        <nav class="mt-8">
            <a href="#" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 border-r-4 border-blue-500 bg-blue-50">
                <i class="fas fa-tachometer-alt ml-3"></i>
                <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
            </a>
            <a href="home-settings.html" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                <i class="fas fa-home ml-3"></i>
                <span>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </a>
            <a href="trends.html" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                <i class="fas fa-fire ml-3"></i>
                <span>Ø§Ù„ØªØ±Ù†Ø¯Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù…ÙŠÙŠÙ†</span>
            </a>
            <a href="services.html" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                <i class="fas fa-tools ml-3"></i>
                <span>Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</span>
            </a>
            <a href="accounts.html" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                <i class="fas fa-users ml-3"></i>
                <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</span>
            </a>
            <a href="orders.html" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                <i class="fas fa-shopping-cart ml-3"></i>
                <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
            </a>
            <a href="settings.html" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                <i class="fas fa-cog ml-3"></i>
                <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</span>
            </a>
            <a href="stats.html" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600">
                <i class="fas fa-chart-bar ml-3"></i>
                <span>Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª</span>
            </a>
        </nav>
        
        <div class="absolute bottom-0 w-full p-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-white text-sm"></i>
                    </div>
                    <div class="mr-3">
                        <p class="text-sm font-medium text-gray-700" id="adminName">Ø§Ù„Ù…Ø¯ÙŠØ±</p>
                        <p class="text-xs text-gray-500" id="adminRole">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                    </div>
                </div>
                <button onclick="logout()" class="text-red-500 hover:text-red-700">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="main-content mr-64">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="flex items-center justify-between px-6 py-4">
                <div class="flex items-center">
                    <button id="sidebarToggle" class="text-gray-600 hover:text-gray-900 mr-4">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <h2 class="text-2xl font-bold text-gray-800">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
                </div>
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="relative">
                        <button class="text-gray-600 hover:text-gray-900 relative">
                            <i class="fas fa-bell text-xl"></i>
                            <span class="absolute -top-1 -left-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center" id="notificationCount">0</span>
                        </button>
                    </div>
                    <div class="text-sm text-gray-600" id="currentTime"></div>
                </div>
            </div>
        </header>

        <!-- Dashboard Content -->
        <main class="p-6">
            <!-- Welcome Section -->
            <div class="gradient-bg rounded-lg p-6 text-white mb-8">
                <h1 class="text-3xl font-bold mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¯Ù„Ù…Ø§</h1>
                <p class="text-lg opacity-90">Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¯Ù„Ù…Ø§ - Ù…Ù†ØµØ© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙÙŠ Ø¹Ø±Ø¹Ø±</p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="stat-card rounded-lg p-6 text-white card-hover transition-all duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm opacity-90">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
                            <p class="text-3xl font-bold" id="totalUsers">-</p>
                        </div>
                        <i class="fas fa-users text-4xl opacity-80"></i>
                    </div>
                    <div class="mt-4">
                        <span class="text-sm opacity-90" id="newUsers24h">+0 Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>

                <div class="stat-card-2 rounded-lg p-6 text-white card-hover transition-all duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm opacity-90">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù…ÙŠÙŠÙ†</p>
                            <p class="text-3xl font-bold" id="totalMedia">-</p>
                        </div>
                        <i class="fas fa-fire text-4xl opacity-80"></i>
                    </div>
                    <div class="mt-4">
                        <span class="text-sm opacity-90">Ù…Ø­ØªÙˆÙ‰ ØªÙØ§Ø¹Ù„ÙŠ</span>
                    </div>
                </div>

                <div class="stat-card-3 rounded-lg p-6 text-white card-hover transition-all duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm opacity-90">Ù…Ù‚Ø¯Ù…Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø©</p>
                            <p class="text-3xl font-bold" id="totalProviders">-</p>
                        </div>
                        <i class="fas fa-tools text-4xl opacity-80"></i>
                    </div>
                    <div class="mt-4">
                        <span class="text-sm opacity-90">Ø®Ø¯Ù…Ø§Øª Ù…ØªÙ†ÙˆØ¹Ø©</span>
                    </div>
                </div>

                <div class="stat-card-4 rounded-lg p-6 text-white card-hover transition-all duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm opacity-90">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
                            <p class="text-3xl font-bold" id="totalOrders">-</p>
                        </div>
                        <i class="fas fa-shopping-cart text-4xl opacity-80"></i>
                    </div>
                    <div class="mt-4">
                        <span class="text-sm opacity-90" id="newOrders24h">+0 Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…</span>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="window.location.href='home-settings.html'" class="flex items-center justify-center p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors">
                            <i class="fas fa-home text-blue-600 text-2xl ml-3"></i>
                            <span class="text-blue-800 font-medium">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
                        </button>
                        <button onclick="window.location.href='trends.html'" class="flex items-center justify-center p-4 bg-red-50 hover:bg-red-100 rounded-lg transition-colors">
                            <i class="fas fa-fire text-red-600 text-2xl ml-3"></i>
                            <span class="text-red-800 font-medium">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ±Ù†Ø¯Ø§Øª</span>
                        </button>
                        <button onclick="window.location.href='accounts.html'" class="flex items-center justify-center p-4 bg-green-50 hover:bg-green-100 rounded-lg transition-colors">
                            <i class="fas fa-users text-green-600 text-2xl ml-3"></i>
                            <span class="text-green-800 font-medium">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                        </button>
                        <button onclick="window.location.href='orders.html'" class="flex items-center justify-center p-4 bg-yellow-50 hover:bg-yellow-100 rounded-lg transition-colors">
                            <i class="fas fa-shopping-cart text-yellow-600 text-2xl ml-3"></i>
                            <span class="text-yellow-800 font-medium">Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø£Ø®ÙŠØ±</h3>
                    <div id="recentActivity" class="space-y-3">
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-circle text-green-500 text-xs ml-2"></i>
                            <span>ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
                            <span class="mr-auto text-xs text-gray-400">Ù…Ù†Ø° 5 Ø¯Ù‚Ø§Ø¦Ù‚</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-circle text-blue-500 text-xs ml-2"></i>
                            <span>ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù…ÙŠ Ø¬Ø¯ÙŠØ¯</span>
                            <span class="mr-auto text-xs text-gray-400">Ù…Ù†Ø° 15 Ø¯Ù‚ÙŠÙ‚Ø©</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-circle text-yellow-500 text-xs ml-2"></i>
                            <span>ØªÙ… ØªØ­Ø¯ÙŠØ« Ø®Ø¯Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                            <span class="mr-auto text-xs text-gray-400">Ù…Ù†Ø° 30 Ø¯Ù‚ÙŠÙ‚Ø©</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Status -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-green-500 text-xl ml-3"></i>
                            <span class="text-green-800 font-medium">Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                        </div>
                        <span class="text-green-600 text-sm">Ù…ØªØµÙ„</span>
                    </div>
                    <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-green-500 text-xl ml-3"></i>
                            <span class="text-green-800 font-medium">API Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</span>
                        </div>
                        <span class="text-green-600 text-sm">ÙŠØ¹Ù…Ù„</span>
                    </div>
                    <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-green-500 text-xl ml-3"></i>
                            <span class="text-green-800 font-medium">Ø§Ù„Ø£Ù…Ø§Ù†</span>
                        </div>
                        <span class="text-green-600 text-sm">Ù…ÙØ¹Ù„</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                    <p class="text-gray-600">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¯Ù„Ù…Ø§</p>
                </div>
                <form id="loginForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                        <input type="text" id="username" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let authToken = localStorage.getItem('adminToken');
        let currentUser = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 1000);
            
            if (!authToken) {
                showLoginModal();
            } else {
                loadDashboardData();
            }
        });

        // Update time
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ar-SA', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        // Show login modal
        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
        }

        // Hide login modal
        function hideLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
        }

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    currentUser = data;
                    localStorage.setItem('adminToken', authToken);
                    localStorage.setItem('adminUser', JSON.stringify(data));
                    hideLoginModal();
                    loadDashboardData();
                } else {
                    alert('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + data.error);
                }
            } catch (error) {
                alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message);
            }
        });

        // Load dashboard data
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/dashboard/stats', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    updateStats(data);
                } else if (response.status === 401) {
                    logout();
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // Update stats
        function updateStats(data) {
            document.getElementById('totalUsers').textContent = data.totalUsers || 0;
            document.getElementById('totalMedia').textContent = data.totalMedia || 0;
            document.getElementById('totalProviders').textContent = data.totalProviders || 0;
            document.getElementById('totalOrders').textContent = data.totalOrders || 0;
            document.getElementById('newUsers24h').textContent = `+${data.newUsers24h || 0} Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…`;
            document.getElementById('newOrders24h').textContent = `+${data.newOrders24h || 0} Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…`;
        }

        // Logout
        function logout() {
            localStorage.removeItem('adminToken');
            localStorage.removeItem('adminUser');
            authToken = null;
            currentUser = null;
            showLoginModal();
        }

        // Sidebar toggle
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            
            if (sidebar.classList.contains('translate-x-0')) {
                sidebar.classList.remove('translate-x-0');
                sidebar.classList.add('translate-x-full');
                mainContent.classList.remove('mr-64');
                mainContent.classList.add('mr-0');
            } else {
                sidebar.classList.remove('translate-x-full');
                sidebar.classList.add('translate-x-0');
                mainContent.classList.remove('mr-0');
                mainContent.classList.add('mr-64');
            }
        });

        // Auto-refresh data every 30 seconds
        setInterval(loadDashboardData, 30000);
    </script>
</body>
</html>
