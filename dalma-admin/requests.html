<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฅุฏุงุฑุฉ ุงูุทูุจุงุช - Dalma Admin</title>
    <link rel="stylesheet" href="assets/css/admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1>๐ด ุฏููููููุง</h1>
            <p>ููุญุฉ ุงูุชุญูู</p>
        </div>
        
        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item">
                <span class="icon">๐</span>
                <span>ุงูุฑุฆูุณูุฉ</span>
            </a>
            
            <!-- ูุงุฆูุฉ ุงููุณุชุฎุฏููู ุงูููุณุฏูุฉ -->
            <div class="nav-dropdown">
                <a href="#" class="nav-item" onclick="toggleDropdown(event, 'users-dropdown')">
                    <span class="icon">๐ฅ</span>
                    <span>ุงููุณุชุฎุฏููู</span>
                    <span class="dropdown-arrow">โผ</span>
                </a>
                <div class="dropdown-menu" id="users-dropdown">
                    <a href="users.html" class="dropdown-item">
                        <span class="icon">๐ค</span>
                        <span>ุฌููุน ุงููุณุชุฎุฏููู</span>
                    </a>
                    <a href="create-account.html" class="dropdown-item">
                        <span class="icon">โ</span>
                        <span>ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ</span>
                    </a>
                </div>
            </div>
            
            <a href="requests.html" class="nav-item active">
                <span class="icon">๐</span>
                <span>ุฌููุน ุงูุทูุจุงุช</span>
                <span class="badge" id="allRequestsBadge">0</span>
            </a>
            <a href="provider-requests.html" class="nav-item">
                <span class="icon">๐ช</span>
                <span>ุทูุจุงุช ููุฏูู ุงูุฎุฏูุฉ</span>
            </a>
            <a href="posts.html" class="nav-item">
                <span class="icon">๐ฐ</span>
                <span>ุงูููุดูุฑุงุช</span>
            </a>
            <a href="orders.html" class="nav-item">
                <span class="icon">๐</span>
                <span>ุงูุทูุจุงุช</span>
            </a>
            <a href="#" class="nav-item" onclick="logout()">
                <span class="icon">๐ช</span>
                <span>ุชุณุฌูู ุงูุฎุฑูุฌ</span>
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <p>ูุฑุญุจุงูุ <strong id="adminName">Admin</strong></p>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <div>
                <h1>๐ ุฅุฏุงุฑุฉ ุฌููุน ุงูุทูุจุงุช</h1>
                <p>ุนุฑุถ ูุฅุฏุงุฑุฉ ุทูุจุงุช ููุฏูู ุงูุฎุฏูุฉ ูุงูุฅุนูุงูููู</p>
            </div>
            <div class="header-actions">
                <input type="text" class="search-box" id="searchBox" placeholder="ุงูุจุญุซ ูู ุงูุทูุจุงุช...">
                <button class="btn-refresh" onclick="loadAllRequests()">
                    ๐ ุชุญุฏูุซ
                </button>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card pending">
                <div class="stat-icon" style="background: #FEF3C7; color: #D97706;">โณ</div>
                <div class="stat-content">
                    <h3 id="pendingCount">0</h3>
                    <p>ููุฏ ุงูุงูุชุธุงุฑ</p>
                </div>
            </div>
            <div class="stat-card approved">
                <div class="stat-icon" style="background: #D1FAE5; color: #059669;">โ</div>
                <div class="stat-content">
                    <h3 id="approvedCount">0</h3>
                    <p>ุชู ุงููุจูู</p>
                </div>
            </div>
            <div class="stat-card rejected">
                <div class="stat-icon" style="background: #FEE2E2; color: #DC2626;">โ</div>
                <div class="stat-content">
                    <h3 id="rejectedCount">0</h3>
                    <p>ุชู ุงูุฑูุถ</p>
                </div>
            </div>
            <div class="stat-card highlight">
                <div class="stat-icon" style="background: rgba(45, 106, 79, 0.1); color: #2D6A4F;">๐</div>
                <div class="stat-content">
                    <h3 id="totalCount">0</h3>
                    <p>ุฅุฌูุงูู ุงูุทูุจุงุช</p>
                </div>
            </div>
        </div>

        <!-- Provider Requests Section -->
        <div class="section">
            <h3>๐ช ุทูุจุงุช ููุฏูู ุงูุฎุฏูุฉ</h3>
            <div class="filters">
                <div class="filter-group">
                    <button class="filter-btn active" data-filter="all" data-type="provider">ุงููู</button>
                    <button class="filter-btn" data-filter="pending" data-type="provider">ููุฏ ุงูุงูุชุธุงุฑ</button>
                    <button class="filter-btn" data-filter="approved" data-type="provider">ููุจููุฉ</button>
                    <button class="filter-btn" data-filter="rejected" data-type="provider">ูุฑููุถุฉ</button>
                </div>
            </div>
                <div id="providerRequestsLoading" class="loading">
                    <div class="spinner"></div>
                    <p>ุฌุงุฑู ุชุญููู ุงูุทูุจุงุช...</p>
                </div>
                <div id="providerRequestsContent" style="display: none;">
                    <table class="requests-table">
                        <thead>
                            <tr>
                                <th>ุฑูู ุงูุทูุจ</th>
                                <th>ุงุณู ุงููุดุงุท</th>
                                <th>ุงูููุน</th>
                                <th>ุฑูู ุงููุงุชู</th>
                                <th>ุงูุนููุงู</th>
                                <th>ุงูุญุงูุฉ</th>
                                <th>ุชุงุฑูุฎ ุงูุทูุจ</th>
                                <th>ุงูุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody id="providerRequestsTable">
                        </tbody>
                    </table>
                </div>
                <div id="providerRequestsEmpty" class="empty-state" style="display: none;">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <h3>ูุง ุชูุฌุฏ ุทูุจุงุช ููุฏูู ุฎุฏูุฉ</h3>
                    <p>ุณูุชู ุนุฑุถ ุงูุทูุจุงุช ููุง ุนูุฏูุง ูุชู ุฅูุดุงุคูุง</p>
                </div>
            </div>

        <!-- Media Requests Section -->
        <div class="section">
            <h3>๐บ ุทูุจุงุช ุงูุฅุนูุงูููู</h3>
            <div class="filters">
                <div class="filter-group">
                    <button class="filter-btn active" data-filter="all" data-type="media">ุงููู</button>
                    <button class="filter-btn" data-filter="pending" data-type="media">ููุฏ ุงูุงูุชุธุงุฑ</button>
                    <button class="filter-btn" data-filter="approved" data-type="media">ููุจููุฉ</button>
                    <button class="filter-btn" data-filter="rejected" data-type="media">ูุฑููุถุฉ</button>
                </div>
            </div>
                <div id="mediaRequestsLoading" class="loading">
                    <div class="spinner"></div>
                    <p>ุฌุงุฑู ุชุญููู ุงูุทูุจุงุช...</p>
                </div>
                <div id="mediaRequestsContent" style="display: none;">
                    <table class="requests-table">
                        <thead>
                            <tr>
                                <th>ุฑูู ุงูุทูุจ</th>
                                <th>ุงูุงุณู</th>
                                <th>ุฑูู ุงููุงุชู</th>
                                <th>ุฑุงุจุท ุงูุฃุนูุงู</th>
                                <th>ุงูุฎุจุฑุฉ</th>
                                <th>ุงูุญุงูุฉ</th>
                                <th>ุชุงุฑูุฎ ุงูุทูุจ</th>
                                <th>ุงูุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody id="mediaRequestsTable">
                        </tbody>
                    </table>
                </div>
                <div id="mediaRequestsEmpty" class="empty-state" style="display: none;">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                    <h3>ูุง ุชูุฌุฏ ุทูุจุงุช ุฅุนูุงูููู</h3>
                    <p>ุณูุชู ุนุฑุถ ุงูุทูุจุงุช ููุง ุนูุฏูุง ูุชู ุฅูุดุงุคูุง</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Request Details Modal -->
    <div class="modal" id="detailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">ุชูุงุตูู ุงูุทูุจ</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody"></div>
            <div class="modal-actions" id="modalActions"></div>
        </div>
    </div>

    <!-- Reject Reason Modal -->
    <div class="modal" id="rejectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ุณุจุจ ุงูุฑูุถ</h3>
                <button class="modal-close" onclick="closeRejectModal()">&times;</button>
            </div>
            <p style="color: #666; margin-bottom: 15px;">ูุฑุฌู ุฅุฏุฎุงู ุณุจุจ ุฑูุถ ุงูุทูุจ:</p>
            <textarea class="reject-reason" id="rejectReason" placeholder="ุงูุชุจ ุณุจุจ ุงูุฑูุถ ููุง..."></textarea>
            <div class="modal-actions">
                <button class="btn btn-reject" onclick="confirmReject()">ุชุฃููุฏ ุงูุฑูุถ</button>
                <button class="btn btn-delete" onclick="closeRejectModal()">ุฅูุบุงุก</button>
            </div>
        </div>
    </div>

    <script src="assets/js/admin.js"></script>
    <script>
        // API_URL ูุนุฑูู ูู admin.js
        let currentRequestId = null;
        let currentRequestType = null;
        let providerRequests = [];
        let mediaRequests = [];
        let currentProviderFilter = 'all';
        let currentMediaFilter = 'all';

        // Load requests on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadProviderRequests();
            loadMediaRequests();
            setupFilterTabs();
            setupSearch();
        });

        // Load provider requests
        async function loadProviderRequests() {
            try {
                const response = await fetch(`${API_URL}/admin/provider-requests`);
                const data = await response.json();
                providerRequests = data.requests || [];
                renderProviderRequests();
                updateStats();
            } catch (error) {
                console.error('Error loading provider requests:', error);
                showError('providerRequestsLoading', 'ูุดู ุชุญููู ุทูุจุงุช ููุฏูู ุงูุฎุฏูุฉ');
            }
        }

        // Load media requests
        async function loadMediaRequests() {
            try {
                const response = await fetch(`${API_URL}/admin/media-requests`);
                const data = await response.json();
                // API returns array directly, not {requests: [...]}
                mediaRequests = Array.isArray(data) ? data : (data.requests || []);
                renderMediaRequests();
                updateStats();
            } catch (error) {
                console.error('Error loading media requests:', error);
                showError('mediaRequestsLoading', 'ูุดู ุชุญููู ุทูุจุงุช ุงูุฅุนูุงูููู');
            }
        }

        // Render provider requests
        function renderProviderRequests() {
            const loading = document.getElementById('providerRequestsLoading');
            const content = document.getElementById('providerRequestsContent');
            const empty = document.getElementById('providerRequestsEmpty');
            const tbody = document.getElementById('providerRequestsTable');

            loading.style.display = 'none';

            const filteredRequests = currentProviderFilter === 'all' 
                ? providerRequests 
                : providerRequests.filter(r => r.status === currentProviderFilter);

            if (filteredRequests.length === 0) {
                content.style.display = 'none';
                empty.style.display = 'block';
                return;
            }

            content.style.display = 'block';
            empty.style.display = 'none';

            tbody.innerHTML = filteredRequests.map(request => `
                <tr>
                    <td>#${request.id}</td>
                    <td><strong>${request.business_name}</strong></td>
                    <td>${request.business_category}</td>
                    <td>${request.whatsapp_number}</td>
                    <td>${request.location_address}</td>
                    <td><span class="status-badge ${request.status}">${getStatusText(request.status)}</span></td>
                    <td>${formatDate(request.created_at)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-view" onclick="viewProviderRequest(${request.id})">ุนุฑุถ</button>
                            ${request.status === 'pending' ? `
                                <button class="btn btn-approve" onclick="approveProviderRequest(${request.id})">ูุจูู</button>
                                <button class="btn btn-reject" onclick="startRejectRequest(${request.id}, 'provider')">ุฑูุถ</button>
                            ` : ''}
                            <button class="btn btn-delete" onclick="deleteProviderRequest(${request.id})">ุญุฐู</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Render media requests
        function renderMediaRequests() {
            const loading = document.getElementById('mediaRequestsLoading');
            const content = document.getElementById('mediaRequestsContent');
            const empty = document.getElementById('mediaRequestsEmpty');
            const tbody = document.getElementById('mediaRequestsTable');

            loading.style.display = 'none';

            const filteredRequests = currentMediaFilter === 'all' 
                ? mediaRequests 
                : mediaRequests.filter(r => r.status === currentMediaFilter);

            if (filteredRequests.length === 0) {
                content.style.display = 'none';
                empty.style.display = 'block';
                return;
            }

            content.style.display = 'block';
            empty.style.display = 'none';

            tbody.innerHTML = filteredRequests.map(request => `
                <tr>
                    <td>#${request.id}</td>
                    <td><strong>${request.name || request.user_name || 'ุบูุฑ ูุญุฏุฏ'}</strong></td>
                    <td>${request.phone || request.user_phone || 'ุบูุฑ ูุญุฏุฏ'}</td>
                    <td>${request.portfolio_url ? `<a href="${request.portfolio_url}" target="_blank" style="color: #2D6A4F; text-decoration: none;">ุฑุงุจุท ุงูุฃุนูุงู</a>` : 'ุบูุฑ ูุญุฏุฏ'}</td>
                    <td>${request.experience ? request.experience.substring(0, 30) + '...' : 'ุบูุฑ ูุญุฏุฏ'}</td>
                    <td><span class="status-badge ${request.status}">${getStatusText(request.status)}</span></td>
                    <td>${formatDate(request.created_at)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-view" onclick="viewMediaRequest(${request.id})">ุนุฑุถ</button>
                            ${request.status === 'pending' ? `
                                <button class="btn btn-approve" onclick="approveMediaRequest(${request.id})">ูุจูู</button>
                                <button class="btn btn-reject" onclick="startRejectRequest(${request.id}, 'media')">ุฑูุถ</button>
                            ` : ''}
                            <button class="btn btn-delete" onclick="deleteMediaRequest(${request.id})">ุญุฐู</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // View provider request details
        function viewProviderRequest(id) {
            const request = providerRequests.find(r => r.id === id);
            if (!request) return;

            document.getElementById('modalTitle').textContent = `ุชูุงุตูู ุทูุจ ููุฏู ุฎุฏูุฉ #${id}`;
            document.getElementById('modalBody').innerHTML = `
                <h4 style="color: #2D6A4F; margin-bottom: 15px; border-bottom: 2px solid #2D6A4F; padding-bottom: 10px;">๐ค ูุนูููุงุช ุงููุณุชุฎุฏู</h4>
                <div class="detail-row">
                    <div class="detail-label">ุงูุงุณู:</div>
                    <div class="detail-value"><strong>${request.user_name || 'ุบูุฑ ูุญุฏุฏ'}</strong></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ุฑูู ุงูุฌูุงู:</div>
                    <div class="detail-value">${request.user_phone || 'ุบูุฑ ูุญุฏุฏ'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ุงูุฏูุฑ ุงูุญุงูู:</div>
                    <div class="detail-value"><span class="status-badge pending">${request.current_role === 'user' ? 'ูุณุชุฎุฏู ุนุงุฏู' : request.current_role === 'media' ? 'ุฅุนูุงูู' : 'ููุฏู ุฎุฏูุฉ'}</span></div>
                </div>
                
                <h4 style="color: #2D6A4F; margin: 20px 0 15px; border-bottom: 2px solid #2D6A4F; padding-bottom: 10px;">๐ช ูุนูููุงุช ุงููุดุงุท ุงูุชุฌุงุฑู</h4>
                <div class="detail-row">
                    <div class="detail-label">ุงุณู ุงููุดุงุท:</div>
                    <div class="detail-value"><strong>${request.business_name}</strong></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ููุน ุงููุดุงุท:</div>
                    <div class="detail-value">${request.business_category}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ุฑูู ุงููุงุชุณุงุจ:</div>
                    <div class="detail-value">${request.whatsapp_number}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</div>
                    <div class="detail-value">${request.email || 'ุบูุฑ ูุญุฏุฏ'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ุงูุนููุงู:</div>
                    <div class="detail-value">${request.location_address}</div>
                </div>
                
                <h4 style="color: #2D6A4F; margin: 20px 0 15px; border-bottom: 2px solid #2D6A4F; padding-bottom: 10px;">๐ ุญุงูุฉ ุงูุทูุจ</h4>
                <div class="detail-row">
                    <div class="detail-label">ุงูุญุงูุฉ:</div>
                    <div class="detail-value"><span class="status-badge ${request.status}">${getStatusText(request.status)}</span></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ุชุงุฑูุฎ ุงูุทูุจ:</div>
                    <div class="detail-value">${formatDate(request.created_at)}</div>
                </div>
                ${request.rejected_reason ? `
                    <div class="detail-row">
                        <div class="detail-label">ุณุจุจ ุงูุฑูุถ:</div>
                        <div class="detail-value" style="color: #DC2626;">${request.rejected_reason}</div>
                    </div>
                ` : ''}
            `;

            document.getElementById('modalActions').innerHTML = request.status === 'pending' ? `
                <button class="btn btn-approve" onclick="approveProviderRequest(${id}); closeModal();">ูุจูู ุงูุทูุจ</button>
                <button class="btn btn-reject" onclick="startRejectRequest(${id}, 'provider'); closeModal();">ุฑูุถ ุงูุทูุจ</button>
                <button class="btn btn-delete" onclick="closeModal()">ุฅุบูุงู</button>
            ` : `
                <button class="btn btn-delete" onclick="closeModal()">ุฅุบูุงู</button>
            `;

            document.getElementById('detailsModal').classList.add('active');
        }

        // View media request details
        function viewMediaRequest(id) {
            const request = mediaRequests.find(r => r.id === id);
            if (!request) return;

            document.getElementById('modalTitle').textContent = `ุชูุงุตูู ุทูุจ ุฅุนูุงูู #${id}`;
            document.getElementById('modalBody').innerHTML = `
                <h4 style="color: #2D6A4F; margin-bottom: 15px; border-bottom: 2px solid #2D6A4F; padding-bottom: 10px;">๐ค ูุนูููุงุช ุงููุณุชุฎุฏู</h4>
                <div class="detail-row">
                    <div class="detail-label">ุงูุงุณู:</div>
                    <div class="detail-value"><strong>${request.name || request.user_name || 'ุบูุฑ ูุญุฏุฏ'}</strong></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ุฑูู ุงูุฌูุงู:</div>
                    <div class="detail-value">${request.phone || request.user_phone || 'ุบูุฑ ูุญุฏุฏ'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ุงูุฏูุฑ ุงูุญุงูู:</div>
                    <div class="detail-value"><span class="status-badge pending">${request.current_role === 'user' ? 'ูุณุชุฎุฏู ุนุงุฏู' : request.current_role === 'media' ? 'ุฅุนูุงูู' : 'ููุฏู ุฎุฏูุฉ'}</span></div>
                </div>
                
                <h4 style="color: #2D6A4F; margin: 20px 0 15px; border-bottom: 2px solid #2D6A4F; padding-bottom: 10px;">๐บ ูุนูููุงุช ุงูุทูุจ</h4>
                <div class="detail-row">
                    <div class="detail-label">ุงูุณุจุจ:</div>
                    <div class="detail-value">${request.reason || 'ุบูุฑ ูุญุฏุฏ'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ุฑุงุจุท ุงูุฃุนูุงู:</div>
                    <div class="detail-value">${request.portfolio_url ? `<a href="${request.portfolio_url}" target="_blank" style="color: #2D6A4F;">${request.portfolio_url}</a>` : 'ุบูุฑ ูุญุฏุฏ'}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ุงูุฎุจุฑุฉ:</div>
                    <div class="detail-value">${request.experience || 'ุบูุฑ ูุญุฏุฏ'}</div>
                </div>
                
                <h4 style="color: #2D6A4F; margin: 20px 0 15px; border-bottom: 2px solid #2D6A4F; padding-bottom: 10px;">๐ ุญุงูุฉ ุงูุทูุจ</h4>
                <div class="detail-row">
                    <div class="detail-label">ุงูุญุงูุฉ:</div>
                    <div class="detail-value"><span class="status-badge ${request.status}">${getStatusText(request.status)}</span></div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ุชุงุฑูุฎ ุงูุทูุจ:</div>
                    <div class="detail-value">${formatDate(request.created_at)}</div>
                </div>
                ${request.admin_notes ? `
                    <div class="detail-row">
                        <div class="detail-label">ููุงุญุธุงุช ุงูุฅุฏุงุฑุฉ:</div>
                        <div class="detail-value" style="color: #DC2626;">${request.admin_notes}</div>
                    </div>
                ` : ''}
            `;

            document.getElementById('modalActions').innerHTML = request.status === 'pending' ? `
                <button class="btn btn-approve" onclick="approveMediaRequest(${id}); closeModal();">ูุจูู ุงูุทูุจ</button>
                <button class="btn btn-reject" onclick="startRejectRequest(${id}, 'media'); closeModal();">ุฑูุถ ุงูุทูุจ</button>
                <button class="btn btn-delete" onclick="closeModal()">ุฅุบูุงู</button>
            ` : `
                <button class="btn btn-delete" onclick="closeModal()">ุฅุบูุงู</button>
            `;

            document.getElementById('detailsModal').classList.add('active');
        }

        // Approve provider request
        async function approveProviderRequest(id) {
            if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ูุจูู ูุฐุง ุงูุทูุจุ')) return;

            try {
                const response = await fetch(`${API_URL}/admin/provider-requests/${id}/approve`, {
                    method: 'POST'
                });

                if (response.ok) {
                    alert('ุชู ูุจูู ุงูุทูุจ ุจูุฌุงุญ!');
                    loadProviderRequests();
                } else {
                    alert('ูุดู ูุจูู ุงูุทูุจ');
                }
            } catch (error) {
                console.error('Error approving request:', error);
                alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ูุจูู ุงูุทูุจ');
            }
        }

        // Approve media request
        async function approveMediaRequest(id) {
            if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ูุจูู ูุฐุง ุงูุทูุจุ')) return;

            try {
                const response = await fetch(`${API_URL}/admin/media-requests/${id}/approve`, {
                    method: 'POST'
                });

                if (response.ok) {
                    alert('ุชู ูุจูู ุงูุทูุจ ุจูุฌุงุญ!');
                    loadMediaRequests();
                } else {
                    alert('ูุดู ูุจูู ุงูุทูุจ');
                }
            } catch (error) {
                console.error('Error approving request:', error);
                alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ูุจูู ุงูุทูุจ');
            }
        }

        // Start reject request
        function startRejectRequest(id, type) {
            currentRequestId = id;
            currentRequestType = type;
            document.getElementById('rejectReason').value = '';
            document.getElementById('rejectModal').classList.add('active');
        }

        // Confirm reject
        async function confirmReject() {
            const reason = document.getElementById('rejectReason').value.trim();
            
            if (!reason) {
                alert('ูุฑุฌู ุฅุฏุฎุงู ุณุจุจ ุงูุฑูุถ');
                return;
            }

            try {
                const endpoint = currentRequestType === 'provider' 
                    ? `/admin/provider-requests/${currentRequestId}/reject`
                    : `/admin/media-requests/${currentRequestId}/reject`;

                const response = await fetch(`${API_URL}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ reason })
                });

                if (response.ok) {
                    alert('ุชู ุฑูุถ ุงูุทูุจ');
                    closeRejectModal();
                    
                    if (currentRequestType === 'provider') {
                        loadProviderRequests();
                    } else {
                        loadMediaRequests();
                    }
                } else {
                    alert('ูุดู ุฑูุถ ุงูุทูุจ');
                }
            } catch (error) {
                console.error('Error rejecting request:', error);
                alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฑูุถ ุงูุทูุจ');
            }
        }

        // Delete provider request
        async function deleteProviderRequest(id) {
            if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุทูุจุ')) return;

            try {
                const response = await fetch(`${API_URL}/admin/provider-requests/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('ุชู ุญุฐู ุงูุทูุจ ุจูุฌุงุญ');
                    loadProviderRequests();
                } else {
                    alert('ูุดู ุญุฐู ุงูุทูุจ');
                }
            } catch (error) {
                console.error('Error deleting request:', error);
                alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญุฐู ุงูุทูุจ');
            }
        }

        // Delete media request
        async function deleteMediaRequest(id) {
            if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุทูุจุ')) return;

            try {
                const response = await fetch(`${API_URL}/admin/media-requests/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('ุชู ุญุฐู ุงูุทูุจ ุจูุฌุงุญ');
                    loadMediaRequests();
                } else {
                    alert('ูุดู ุญุฐู ุงูุทูุจ');
                }
            } catch (error) {
                console.error('Error deleting request:', error);
                alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญุฐู ุงูุทูุจ');
            }
        }

        // Update statistics
        function updateStats() {
            const allRequests = [...providerRequests, ...mediaRequests];
            
            document.getElementById('totalCount').textContent = allRequests.length;
            document.getElementById('pendingCount').textContent = allRequests.filter(r => r.status === 'pending').length;
            document.getElementById('approvedCount').textContent = allRequests.filter(r => r.status === 'approved').length;
            document.getElementById('rejectedCount').textContent = allRequests.filter(r => r.status === 'rejected').length;
        }

        // Setup filter tabs
        function setupFilterTabs() {
            document.querySelectorAll('.filter-btn').forEach(tab => {
                tab.addEventListener('click', () => {
                    const filter = tab.dataset.filter;
                    const type = tab.dataset.type;
                    
                    // Update active tab
                    tab.parentElement.querySelectorAll('.filter-btn').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Update filter and re-render
                    if (type === 'provider') {
                        currentProviderFilter = filter;
                        renderProviderRequests();
                    } else {
                        currentMediaFilter = filter;
                        renderMediaRequests();
                    }
                });
            });
        }

        // Setup search
        function setupSearch() {
            const searchBox = document.getElementById('searchBox');
            searchBox.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                
                // Filter provider requests
                const filteredProvider = providerRequests.filter(r => 
                    r.business_name.toLowerCase().includes(query) ||
                    r.business_category.toLowerCase().includes(query) ||
                    r.whatsapp_number.includes(query) ||
                    r.location_address.toLowerCase().includes(query)
                );
                
                // Filter media requests
                const filteredMedia = mediaRequests.filter(r => 
                    (r.user_name || '').toLowerCase().includes(query) ||
                    (r.user_phone || '').includes(query) ||
                    (r.email || '').toLowerCase().includes(query) ||
                    (r.content_type || '').toLowerCase().includes(query)
                );
                
                // Temporarily override the arrays
                const originalProvider = providerRequests;
                const originalMedia = mediaRequests;
                
                providerRequests = filteredProvider;
                mediaRequests = filteredMedia;
                
                renderProviderRequests();
                renderMediaRequests();
                
                // Restore original arrays
                if (query === '') {
                    providerRequests = originalProvider;
                    mediaRequests = originalMedia;
                }
            });
        }

        // Utility functions
        function getStatusText(status) {
            const statusMap = {
                'pending': 'ููุฏ ุงูุงูุชุธุงุฑ',
                'approved': 'ููุจูู',
                'rejected': 'ูุฑููุถ'
            };
            return statusMap[status] || status;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-SA', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function closeModal() {
            document.getElementById('detailsModal').classList.remove('active');
        }

        function closeRejectModal() {
            document.getElementById('rejectModal').classList.remove('active');
            currentRequestId = null;
            currentRequestType = null;
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <div style="color: #DC2626; padding: 40px; text-align: center;">
                    <p style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">โ ุญุฏุซ ุฎุทุฃ</p>
                    <p>${message}</p>
                    <button class="btn btn-view" onclick="location.reload()" style="margin-top: 20px;">ุฅุนุงุฏุฉ ุงููุญุงููุฉ</button>
                </div>
            `;
        }

        // Auto refresh every 30 seconds
        setInterval(() => {
            loadProviderRequests();
            loadMediaRequests();
        }, 30000);

        // Toggle dropdown menu
        function toggleDropdown(event, dropdownId) {
            event.preventDefault();
            const dropdown = document.getElementById(dropdownId);
            const isActive = dropdown.classList.contains('show');
            
            // Close all dropdowns first
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                menu.classList.remove('show');
            });
            
            // Toggle current dropdown
            if (!isActive) {
                dropdown.classList.add('show');
            }
        }

        // Logout function
        function logout() {
            if (confirm('ูู ุชุฑูุฏ ุชุณุฌูู ุงูุฎุฑูุฌุ')) {
                window.location.href = 'login.html';
            }
        }
    </script>
</body>
</html>


